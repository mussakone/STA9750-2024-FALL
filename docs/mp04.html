<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mussa Kone">

<title>Which CUNY Retirement Plan is the best option? – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Which CUNY Retirement Plan is the best option?</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mussa Kone </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
</section>
<section id="section" class="level1">
<h1></h1>
<p>For this mini project, faculty that has been hired by CUNY has a an important decision to make when it comes to finances. They have 30 days to choose one out of two retirement plans that CUNY offers. The two plans are the Teachers Retirement System (TRS) and Optional Retirement Plan (ORP) TRS is a more traditional pension plan while the newer ORP is more like a 401k plan. Our job in the project is to assess which plan is better than the other by looking at historical financial data and using other strategies.</p>
<section id="task-1-register-for-alphavantage-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-1-register-for-alphavantage-api-key">Task 1 Register for AlphaVantage API Key</h2>
<p>For this first task all we are doing is registering for an AlphaVantage API Key in order to access documentation and data that we will need for for our project.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the path to the file containing your API key</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>api_key_path <span class="ot">&lt;-</span> <span class="st">"alphavantage_key.txt"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the API key securely</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>alpha_vantage_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(api_key_path)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(alpha_vantage_key)) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"API key successfully read."</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Failed to read API key."</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>API key successfully read.</code></pre>
</div>
</div>
</section>
<section id="task-2-register-for-fred-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-2-register-for-fred-api-key">Task 2 Register for FRED API Key</h2>
<p>For this task, similar to the first one all we are doing is registering for a FRED API Key to access data and documentation we will need to conduct this mini project.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the path to the file containing your API key</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>api_key_path <span class="ot">&lt;-</span> <span class="st">"fred_key.txt"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the API key securely</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>fred_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(api_key_path)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(fred_api_key)) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"FRED API key successfully read."</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Failed to read FRED API key."</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>FRED API key successfully read.</code></pre>
</div>
</div>
</section>
<section id="task-3-data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="task-3-data-acquisition">Task 3 Data Acquisition</h2>
<p>For this task, we will now begin our Monte Carlo Analysis. In order to do this we will utilize the API keys we previously secured to access historical data from both data sources, AlphaVantage and FRED. The historical data series that we are looking to download are from inputs such as inflation, wage growth, US Equity Market total returns, International Equity Market total returns, bond market total returns, and short-term debt returns.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)  <span class="co"># For fill()</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)     <span class="co"># For scrollable tables</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load API keys</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>alpha_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>fred_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"fred_key.txt"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Base URLs</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>alpha_base_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>fred_base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the date range</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">floor_date</span>(<span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="fu">years</span>(<span class="dv">15</span>), <span class="st">"month"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">floor_date</span>(<span class="fu">Sys.Date</span>(), <span class="st">"month"</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to fetch AlphaVantage data</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>fetch_alpha_data <span class="ot">&lt;-</span> <span class="cf">function</span>(symbol) {</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="fu">paste0</span>(alpha_base_url, </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"?function=TIME_SERIES_MONTHLY_ADJUSTED"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"&amp;symbol="</span>, symbol, </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"&amp;apikey="</span>, alpha_key)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  time_series <span class="ot">&lt;-</span> content[[<span class="st">"Monthly Adjusted Time Series"</span>]]</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(time_series)) <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"No data returned for symbol:"</span>, symbol))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(time_series)),</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_close =</span> <span class="fu">map_dbl</span>(time_series, <span class="sc">~</span> <span class="fu">as.numeric</span>(.x[[<span class="st">"5. adjusted close"</span>]] <span class="sc">%||%</span> <span class="cn">NA_real_</span>))</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to fetch FRED data</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>fetch_fred_data <span class="ot">&lt;-</span> <span class="cf">function</span>(series_id) {</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="fu">paste0</span>(fred_base_url,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"?series_id="</span>, series_id,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"&amp;api_key="</span>, fred_key,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"&amp;file_type=json"</span>)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  content <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"parsed"</span>)</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  observations <span class="ot">&lt;-</span> content[[<span class="st">"observations"</span>]]</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(observations)) <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"No data returned for FRED series:"</span>, series_id))</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">map_chr</span>(observations, <span class="st">"date"</span>)),</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">map_dbl</span>(observations, <span class="sc">~</span> <span class="fu">as.numeric</span>(.x[[<span class="st">"value"</span>]]))  <span class="co"># Explicit conversion</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> end_date)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch datasets</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>ibm_data <span class="ot">&lt;-</span> <span class="fu">fetch_alpha_data</span>(<span class="st">"IBM"</span>)  <span class="co"># IBM as the US equity proxy</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>intl_equity <span class="ot">&lt;-</span> <span class="fu">fetch_alpha_data</span>(<span class="st">"EFA"</span>)  <span class="co"># iShares MSCI EAFE ETF as international equity proxy</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>wage_growth <span class="ot">&lt;-</span> <span class="fu">fetch_fred_data</span>(<span class="st">"CES0500000003"</span>)  <span class="co"># Wage growth</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>inflation <span class="ot">&lt;-</span> <span class="fu">fetch_fred_data</span>(<span class="st">"CPIAUCSL"</span>)  <span class="co"># Inflation</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>bond_returns <span class="ot">&lt;-</span> <span class="fu">fetch_fred_data</span>(<span class="st">"AAA"</span>)  <span class="co"># Bond returns</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>short_term_debt <span class="ot">&lt;-</span> <span class="fu">fetch_fred_data</span>(<span class="st">"TB3MS"</span>)  <span class="co"># Short-term debt</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine datasets</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_equity =</span> ibm_data <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">adjusted_close_us =</span> adjusted_close),</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">intl_equity =</span> intl_equity <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">adjusted_close_intl =</span> adjusted_close),</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_growth =</span> wage_growth <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">wage_growth =</span> value),</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">inflation =</span> inflation <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">inflation =</span> value),</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">bond_returns =</span> bond_returns <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">bond_returns =</span> value),</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">short_term_debt =</span> short_term_debt <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">short_term_debt_returns =</span> value)</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">reduce</span>(full_join, <span class="at">by =</span> <span class="st">"date"</span>)  <span class="co"># Combine datasets by "date"</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> final_data <span class="sc">|&gt;</span> </span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span>  <span class="co"># Sort by date</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(<span class="fu">everything</span>(), <span class="at">.direction =</span> <span class="st">"downup"</span>)  <span class="co"># Forward and backward fill</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the cleaned and imputed dataset</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(final_data, <span class="st">"historical_economic_data_full.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Full data saved successfully to 'historical_economic_data_full.csv'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Full data saved successfully to 'historical_economic_data_full.csv'."</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as a scrollable, subsampled table in RStudio</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  final_data,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">scrollX =</span> <span class="cn">TRUE</span>,  <span class="co"># Enable horizontal scrolling</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">scrollY =</span> <span class="st">"500px"</span>,  <span class="co"># Enable vertical scrolling</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,  <span class="co"># Show 10 rows per page for better subsampling</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lengthMenu =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>)  <span class="co"># Allow user to select number of rows to view</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Historical Economic Data Table"</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1d2c714e3c49a59891c6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1d2c714e3c49a59891c6">{"x":{"filter":"none","vertical":false,"caption":"<caption>Historical Economic Data Table<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360"],["2009-12-01","2009-12-31","2010-01-01","2010-01-29","2010-02-01","2010-02-26","2010-03-01","2010-03-31","2010-04-01","2010-04-30","2010-05-01","2010-05-28","2010-06-01","2010-06-30","2010-07-01","2010-07-30","2010-08-01","2010-08-31","2010-09-01","2010-09-30","2010-10-01","2010-10-29","2010-11-01","2010-11-30","2010-12-01","2010-12-31","2011-01-01","2011-01-31","2011-02-01","2011-02-28","2011-03-01","2011-03-31","2011-04-01","2011-04-29","2011-05-01","2011-05-31","2011-06-01","2011-06-30","2011-07-01","2011-07-29","2011-08-01","2011-08-31","2011-09-01","2011-09-30","2011-10-01","2011-10-31","2011-11-01","2011-11-30","2011-12-01","2011-12-30","2012-01-01","2012-01-31","2012-02-01","2012-02-29","2012-03-01","2012-03-30","2012-04-01","2012-04-30","2012-05-01","2012-05-31","2012-06-01","2012-06-29","2012-07-01","2012-07-31","2012-08-01","2012-08-31","2012-09-01","2012-09-28","2012-10-01","2012-10-31","2012-11-01","2012-11-30","2012-12-01","2012-12-31","2013-01-01","2013-01-31","2013-02-01","2013-02-28","2013-03-01","2013-03-28","2013-04-01","2013-04-30","2013-05-01","2013-05-31","2013-06-01","2013-06-28","2013-07-01","2013-07-31","2013-08-01","2013-08-30","2013-09-01","2013-09-30","2013-10-01","2013-10-31","2013-11-01","2013-11-29","2013-12-01","2013-12-31","2014-01-01","2014-01-31","2014-02-01","2014-02-28","2014-03-01","2014-03-31","2014-04-01","2014-04-30","2014-05-01","2014-05-30","2014-06-01","2014-06-30","2014-07-01","2014-07-31","2014-08-01","2014-08-29","2014-09-01","2014-09-30","2014-10-01","2014-10-31","2014-11-01","2014-11-28","2014-12-01","2014-12-31","2015-01-01","2015-01-30","2015-02-01","2015-02-27","2015-03-01","2015-03-31","2015-04-01","2015-04-30","2015-05-01","2015-05-29","2015-06-01","2015-06-30","2015-07-01","2015-07-31","2015-08-01","2015-08-31","2015-09-01","2015-09-30","2015-10-01","2015-10-30","2015-11-01","2015-11-30","2015-12-01","2015-12-31","2016-01-01","2016-01-29","2016-02-01","2016-02-29","2016-03-01","2016-03-31","2016-04-01","2016-04-29","2016-05-01","2016-05-31","2016-06-01","2016-06-30","2016-07-01","2016-07-29","2016-08-01","2016-08-31","2016-09-01","2016-09-30","2016-10-01","2016-10-31","2016-11-01","2016-11-30","2016-12-01","2016-12-30","2017-01-01","2017-01-31","2017-02-01","2017-02-28","2017-03-01","2017-03-31","2017-04-01","2017-04-28","2017-05-01","2017-05-31","2017-06-01","2017-06-30","2017-07-01","2017-07-31","2017-08-01","2017-08-31","2017-09-01","2017-09-29","2017-10-01","2017-10-31","2017-11-01","2017-11-30","2017-12-01","2017-12-29","2018-01-01","2018-01-31","2018-02-01","2018-02-28","2018-03-01","2018-03-29","2018-04-01","2018-04-30","2018-05-01","2018-05-31","2018-06-01","2018-06-29","2018-07-01","2018-07-31","2018-08-01","2018-08-31","2018-09-01","2018-09-28","2018-10-01","2018-10-31","2018-11-01","2018-11-30","2018-12-01","2018-12-31","2019-01-01","2019-01-31","2019-02-01","2019-02-28","2019-03-01","2019-03-29","2019-04-01","2019-04-30","2019-05-01","2019-05-31","2019-06-01","2019-06-28","2019-07-01","2019-07-31","2019-08-01","2019-08-30","2019-09-01","2019-09-30","2019-10-01","2019-10-31","2019-11-01","2019-11-29","2019-12-01","2019-12-31","2020-01-01","2020-01-31","2020-02-01","2020-02-28","2020-03-01","2020-03-31","2020-04-01","2020-04-30","2020-05-01","2020-05-29","2020-06-01","2020-06-30","2020-07-01","2020-07-31","2020-08-01","2020-08-31","2020-09-01","2020-09-30","2020-10-01","2020-10-30","2020-11-01","2020-11-30","2020-12-01","2020-12-31","2021-01-01","2021-01-29","2021-02-01","2021-02-26","2021-03-01","2021-03-31","2021-04-01","2021-04-30","2021-05-01","2021-05-28","2021-06-01","2021-06-30","2021-07-01","2021-07-30","2021-08-01","2021-08-31","2021-09-01","2021-09-30","2021-10-01","2021-10-29","2021-11-01","2021-11-30","2021-12-01","2021-12-31","2022-01-01","2022-01-31","2022-02-01","2022-02-28","2022-03-01","2022-03-31","2022-04-01","2022-04-29","2022-05-01","2022-05-31","2022-06-01","2022-06-30","2022-07-01","2022-07-29","2022-08-01","2022-08-31","2022-09-01","2022-09-30","2022-10-01","2022-10-31","2022-11-01","2022-11-30","2022-12-01","2022-12-30","2023-01-01","2023-01-31","2023-02-01","2023-02-28","2023-03-01","2023-03-31","2023-04-01","2023-04-28","2023-05-01","2023-05-31","2023-06-01","2023-06-30","2023-07-01","2023-07-31","2023-08-01","2023-08-31","2023-09-01","2023-09-29","2023-10-01","2023-10-31","2023-11-01","2023-11-30","2023-12-01","2023-12-29","2024-01-01","2024-01-31","2024-02-01","2024-02-29","2024-03-01","2024-03-28","2024-04-01","2024-04-30","2024-05-01","2024-05-31","2024-06-01","2024-06-28","2024-07-01","2024-07-31","2024-08-01","2024-08-30","2024-09-01","2024-09-30","2024-10-01","2024-10-31","2024-11-01","2024-11-29"],[73.78570000000001,73.78570000000001,73.78570000000001,68.9888,68.9888,72.001,72.001,72.6182,72.6182,73.0429,73.0429,71.2972,71.2972,70.2841,70.2841,73.08450000000001,73.08450000000001,70.4349,70.4349,76.733,76.733,82.14449999999999,82.14449999999999,81.2795,81.2795,84.32470000000001,84.32470000000001,93.0812,93.0812,93.3764,93.3764,94.0628,94.0628,98.3948,98.3948,97.87569999999999,97.87569999999999,99.3937,99.3937,105.3614,105.3614,100.0517,100.0517,101.7744,101.7744,107.4548,107.4548,109.8543,109.8543,107.4469,107.4469,112.5423,112.5423,115.4024,115.4024,122.3947,122.3947,121.4737,121.4737,113.6331,113.6331,115.2118,115.2118,115.4474,115.4474,115.272,115.272,122.7261,122.7261,115.0827,115.0827,112.9442,112.9442,113.8236,113.8236,120.6691,120.6691,119.8426,119.8426,127.2839,127.2839,120.863,120.863,124.7089,124.7089,114.5713,114.5713,116.9274,116.9274,109.8222,109.8222,111.5756,111.5756,107.9785,107.9785,108.8356,108.8356,113.6148,113.6148,107.0185,107.0185,112.7711,112.7711,117.229,117.229,119.6529,119.6529,112.9302,112.9302,111.0374,111.0374,117.4079,117.4079,118.4906,118.4906,116.9686,116.9686,101.2993,101.2993,100.606,100.606,99.53279999999999,99.53279999999999,95.1095,95.1095,101.1685,101.1685,100.2688,100.2688,107.0097,107.0097,106.7953,106.7953,102.3951,102.3951,101.9733,101.9733,93.8716,93.8716,92.0181,92.0181,88.91419999999999,88.91419999999999,89.3275,89.3275,88.1742,88.1742,79.9539,79.9539,84.81140000000001,84.81140000000001,98.0286,98.0286,94.4622,94.4622,100.4567,100.4567,99.176,99.176,104.9522,104.9522,104.7122,104.7122,104.6925,104.6925,101.2917,101.2917,107.8781,107.8781,110.3852,110.3852,116.0578,116.0578,120.5326,120.5326,116.7253,116.7253,107.4417,107.4417,103.3101,103.3101,104.1223,104.1223,97.9222,97.9222,97.834,97.834,99.2363,99.2363,105.3787,105.3787,106.3682,106.3682,105.9882,105.9882,113.09,113.09,108.7473,108.7473,107.0724,107.0724,101.1615,101.1615,99.7,99.7,98.5641,98.5641,102.2541,102.2541,104.4684,104.4684,107.8418,107.8418,82.32380000000001,82.32380000000001,89.75620000000001,89.75620000000001,82.1002,82.1002,97.0872,97.0872,100.9429,100.9429,103.1133,103.1133,102.5067,102.5067,93.9128,93.9128,101.981,101.981,109.6278,109.6278,101.3873,101.3873,108.7858,108.7858,100.0408,100.0408,101.7628,101.7628,101.4524,101.4524,108.7866,108.7866,99.5484,99.5484,84.8475,84.8475,96.0376,96.0376,96.8173,96.8173,93.6159,93.6159,95.298,95.298,96.83159999999999,96.83159999999999,95.5438,95.5438,87.6832,87.6832,98.3651,98.3651,100.2444,100.2444,94.8532,94.8532,95.9742,95.9742,107.5382,107.5382,114.4944,114.4944,117.3031,117.3031,119.629,119.629,115.0344,115.0344,115.8582,115.8582,114.6942,114.6942,103.2768,103.2768,102.4915,102.4915,116.9856,116.9856,116.9069,116.9069,108.5437,108.5437,115.1975,115.1975,117.1378,117.1378,124.5218,124.5218,126.6294,126.6294,117.3019,117.3019,116.6714,116.6714,107.9154,107.9154,125.6091,125.6091,136.8705,136.8705,129.5076,129.5076,123.8453,123.8453,120.3202,120.3202,121.9859,121.9859,117.6309,117.6309,121.2988,121.2988,126.2228,126.2228,136.0048,136.0048,140.1181,140.1181,133.8866,133.8866,138.0282,138.0282,153.025,153.025,157.8409,157.8409,177.2489,177.2489,180.1789,180.1789,185.9534,185.9534,161.8426,161.8426,164.1074,164.1074,170.1072,170.1072,188.9817,188.9817,200.5417,200.5417,219.3428,219.3428,205.0957,205.0957,227.41],[35.9094,35.9094,35.9094,34.0906,34.0906,34.1815,34.1815,36.3641,36.3641,35.3443,35.3443,31.3883,31.3883,30.7373,30.7373,34.306,34.306,33.0041,33.0041,36.2953,36.2953,37.6765,37.6765,35.8591,35.8591,38.8354,38.8354,39.6492,39.6492,41.0567,41.0567,40.0761,40.0761,42.3307,42.3307,41.3969,41.3969,40.9033,40.9033,39.9307,39.9307,36.4348,36.4348,32.4968,32.4968,35.6254,35.6254,34.8501,34.8501,34.0785,34.0785,35.8743,35.8743,37.6082,37.6082,37.7664,37.7664,36.982,36.982,32.8607,32.8607,35.1968,35.1968,35.225,35.225,36.3522,36.3522,37.3385,37.3385,37.7436,37.7436,38.7968,38.7968,40.4917,40.4917,42.0015,42.0015,41.4567,41.4567,42.0015,42.0015,44.1094,44.1094,42.7777,42.7777,41.6235,41.6235,43.8391,43.8391,42.9819,42.9819,46.3459,46.3459,47.8562,47.8562,48.1177,48.1177,49.1544,49.1544,46.6012,46.6012,49.4584,49.4584,49.2313,49.2313,50.0518,50.0518,50.8503,50.8503,51.3191,51.3191,49.983,49.983,50.0731,50.0731,48.129,48.129,48.0014,48.0014,48.0315,48.0315,46.1085,46.1085,46.3965,46.3965,49.337,49.337,48.6322,48.6322,50.4056,50.4056,50.5042,50.5042,48.9299,48.9299,49.9241,49.9241,46.2171,46.2171,44.1749,44.1749,47.0957,47.0957,46.7412,46.7412,45.6497,45.6497,43.1309,43.1309,41.6927,41.6927,44.4369,44.4369,45.4242,45.4242,45.3854,45.3854,44.2877,44.2877,46.0451,46.0451,46.295,46.295,46.9139,46.9139,45.8745,45.8745,45.0573,45.0573,46.2767,46.2767,47.7998,47.7998,48.3689,48.3689,49.932,49.932,51.1424,51.1424,52.9541,52.9541,53.1175,53.1175,54.5269,54.5269,54.5024,54.5024,55.7897,55.7897,56.7265,56.7265,57.1176,57.1176,57.8899,57.8899,60.7963,60.7963,57.857,57.857,57.3712,57.3712,58.2439,58.2439,57.1407,57.1407,56.2453,56.2453,57.8494,57.8494,56.556,56.556,57.1019,57.1019,52.4575,52.4575,52.7179,52.7179,49.8972,49.8972,53.2078,53.2078,54.5575,54.5575,55.0583,55.0583,56.6712,56.6712,53.819,53.819,56.9998,56.9998,55.8898,55.8898,54.8145,54.8145,56.5489,56.5489,58.4653,58.4653,59.1244,59.1244,60.8881,60.8881,59.1695,59.1695,54.5748,54.5748,46.8761,46.8761,49.6031,49.6031,52.295,52.295,54.1278,54.1278,55.1771,55.1771,57.7826,57.7826,56.5999,56.5999,54.5902,54.5902,62.38,62.38,65.5086,65.5086,64.9969,64.9969,66.45140000000001,66.45140000000001,68.12139999999999,68.12139999999999,70.1327,70.1327,72.5749,72.5749,71.7897,71.7897,72.3449,72.3449,73.39149999999999,73.39149999999999,70.9979,70.9979,73.255,73.255,69.9331,69.9331,73.0163,73.0163,70.3622,70.3622,67.94929999999999,67.94929999999999,68.30200000000001,68.30200000000001,63.699,63.699,64.9704,64.9704,59.3018,59.3018,62.367,62.367,58.5521,58.5521,53.1524,53.1524,56.2841,56.2841,63.6956,63.6956,62.5378,62.5378,68.16849999999999,68.16849999999999,66.0724,66.0724,68.1399,68.1399,70.14060000000001,70.14060000000001,67.3301,67.3301,70.35129999999999,70.35129999999999,72.25320000000001,72.25320000000001,69.4101,69.4101,66.87739999999999,66.87739999999999,64.9367,64.9367,70.27370000000001,70.27370000000001,74.0431,74.0431,73.709,73.709,75.9101,75.9101,78.47490000000001,78.47490000000001,75.9298,75.9298,79.77200000000001,79.77200000000001,78.33,78.33,80.36,80.36,82.98,82.98,83.63,83.63,79.22,79.22,78.97],[22.36,22.36,22.41,22.41,22.45,22.45,22.46,22.46,22.49,22.49,22.53,22.53,22.53,22.53,22.59,22.59,22.62,22.62,22.67,22.67,22.74,22.74,22.73,22.73,22.76,22.76,22.86,22.86,22.87,22.87,22.87,22.87,22.91,22.91,22.98,22.98,23.01,23.01,23.1,23.1,23.07,23.07,23.12,23.12,23.2,23.2,23.19,23.19,23.22,23.22,23.25,23.25,23.28,23.28,23.36,23.36,23.39,23.39,23.4,23.4,23.46,23.46,23.5,23.5,23.48,23.48,23.57,23.57,23.56,23.56,23.63,23.63,23.73,23.73,23.75,23.75,23.78,23.78,23.8,23.8,23.87,23.87,23.89,23.89,23.96,23.96,23.98,23.98,24.02,24.02,24.06,24.06,24.09,24.09,24.16,24.16,24.18,24.18,24.23,24.23,24.33,24.33,24.32,24.32,24.34,24.34,24.4,24.4,24.46,24.46,24.48,24.48,24.54,24.54,24.55,24.55,24.58,24.58,24.66,24.66,24.62,24.62,24.75,24.75,24.79,24.79,24.86,24.86,24.89,24.89,24.97,24.97,24.97,24.97,25,25,25.09,25.09,25.11,25.11,25.19,25.19,25.25,25.25,25.24,25.24,25.38,25.38,25.38,25.38,25.45,25.45,25.53,25.53,25.58,25.58,25.62,25.62,25.69,25.69,25.72,25.72,25.77,25.77,25.89,25.89,25.9,25.9,25.92,25.92,26,26,26.07,26.07,26.11,26.11,26.17,26.17,26.21,26.21,26.26,26.26,26.36,26.36,26.38,26.38,26.49,26.49,26.49,26.49,26.53,26.53,26.61,26.61,26.73,26.73,26.75,26.75,26.86,26.86,26.91,26.91,26.98,26.98,27.04,27.04,27.09,27.09,27.2,27.2,27.32,27.32,27.37,27.37,27.44,27.44,27.55,27.55,27.59,27.59,27.71,27.71,27.8,27.8,27.78,27.78,27.86,27.86,27.95,27.95,28.02,28.02,28.13,28.13,28.17,28.17,28.23,28.23,28.35,28.35,28.37,28.37,28.44,28.44,28.55,28.55,28.77,28.77,30.01,30.01,29.72,29.72,29.38,29.38,29.38,29.38,29.48,29.48,29.51,29.51,29.54,29.54,29.63,29.63,29.9,29.9,29.93,29.93,30.06,30.06,30.06,30.06,30.21,30.21,30.39,30.39,30.54,30.54,30.65,30.65,30.77,30.77,30.95,30.95,31.15,31.15,31.24,31.24,31.4,31.4,31.63,31.63,31.65,31.65,31.84,31.84,31.95,31.95,32.08,32.08,32.2,32.2,32.33,32.33,32.44,32.44,32.54,32.54,32.7,32.7,32.83,32.83,32.94,32.94,33.07,33.07,33.15,33.15,33.31,33.31,33.44,33.44,33.54,33.54,33.7,33.7,33.84,33.84,33.91,33.91,34.01,34.01,34.1,34.1,34.23,34.23,34.34,34.34,34.51,34.51,34.56,34.56,34.69,34.69,34.75,34.75,34.88,34.88,34.99,34.99,35.07,35.07,35.22,35.22,35.33,35.33,35.46,35.46,35.46,35.46],[217.347,217.347,217.488,217.488,217.281,217.281,217.353,217.353,217.403,217.403,217.29,217.29,217.199,217.199,217.605,217.605,217.923,217.923,218.275,218.275,219.035,219.035,219.59,219.59,220.472,220.472,221.187,221.187,221.898,221.898,223.046,223.046,224.093,224.093,224.806,224.806,224.806,224.806,225.395,225.395,226.106,226.106,226.597,226.597,226.75,226.75,227.169,227.169,227.223,227.223,227.842,227.842,228.329,228.329,228.807,228.807,229.187,229.187,228.713,228.713,228.524,228.524,228.59,228.59,229.918,229.918,231.015,231.015,231.638,231.638,231.249,231.249,231.221,231.221,231.679,231.679,232.937,232.937,232.282,232.282,231.797,231.797,231.893,231.893,232.445,232.445,232.9,232.9,233.456,233.456,233.544,233.544,233.669,233.669,234.1,234.1,234.719,234.719,235.288,235.288,235.547,235.547,236.028,236.028,236.468,236.468,236.918,236.918,237.231,237.231,237.498,237.498,237.46,237.46,237.477,237.477,237.43,237.43,236.983,236.983,236.252,236.252,234.747,234.747,235.342,235.342,235.976,235.976,236.222,236.222,237.001,237.001,237.657,237.657,238.034,238.034,238.033,238.033,237.498,237.498,237.733,237.733,238.017,238.017,237.761,237.761,237.652,237.652,237.336,237.336,238.08,238.08,238.992,238.992,239.557,239.557,240.222,240.222,240.101,240.101,240.545,240.545,241.176,241.176,241.741,241.741,242.026,242.026,242.637,242.637,243.618,243.618,244.006,244.006,243.892,243.892,244.193,244.193,244.004,244.004,244.163,244.163,244.243,244.243,245.183,245.183,246.435,246.435,246.626,246.626,247.284,247.284,247.805,247.805,248.859,248.859,249.529,249.529,249.577,249.577,250.227,250.227,250.792,250.792,251.018,251.018,251.214,251.214,251.663,251.663,252.182,252.182,252.772,252.772,252.594,252.594,252.767,252.767,252.561,252.561,253.319,253.319,254.277,254.277,255.233,255.233,255.296,255.296,255.213,255.213,255.802,255.802,256.036,256.036,256.43,256.43,257.155,257.155,257.879,257.879,258.63,258.63,258.906,258.906,259.246,259.246,258.15,258.15,256.126,256.126,255.848,255.848,257.004,257.004,258.408,258.408,259.366,259.366,259.951,259.951,260.249,260.249,260.895,260.895,262.005,262.005,262.518,262.518,263.583,263.583,264.91,264.91,266.752,266.752,268.452,268.452,270.664,270.664,271.994,271.994,272.789,272.789,273.887,273.887,276.434,276.434,278.799,278.799,280.808,280.808,282.39,282.39,284.535,284.535,287.553,287.553,288.764,288.764,291.359,291.359,294.996,294.996,294.977,294.977,295.209,295.209,296.341,296.341,297.863,297.863,298.648,298.648,298.812,298.812,300.356,300.356,301.509,301.509,301.744,301.744,303.032,303.032,303.365,303.365,304.003,304.003,304.628,304.628,306.187,306.187,307.288,307.288,307.531,307.531,308.024,308.024,308.742,308.742,309.685,309.685,311.054,311.054,312.23,312.23,313.207,313.207,313.225,313.225,313.049,313.049,313.534,313.534,314.121,314.121,314.686,314.686,315.454,315.454,315.454,315.454],[5.26,5.26,5.26,5.26,5.35,5.35,5.27,5.27,5.29,5.29,4.96,4.96,4.88,4.88,4.72,4.72,4.49,4.49,4.53,4.53,4.68,4.68,4.87,4.87,5.02,5.02,5.04,5.04,5.22,5.22,5.13,5.13,5.16,5.16,4.96,4.96,4.99,4.99,4.93,4.93,4.37,4.37,4.09,4.09,3.98,3.98,3.87,3.87,3.93,3.93,3.85,3.85,3.85,3.85,3.99,3.99,3.96,3.96,3.8,3.8,3.64,3.64,3.4,3.4,3.48,3.48,3.49,3.49,3.47,3.47,3.5,3.5,3.65,3.65,3.8,3.8,3.9,3.9,3.93,3.93,3.73,3.73,3.89,3.89,4.27,4.27,4.34,4.34,4.54,4.54,4.64,4.64,4.53,4.53,4.63,4.63,4.62,4.62,4.49,4.49,4.45,4.45,4.38,4.38,4.24,4.24,4.16,4.16,4.25,4.25,4.16,4.16,4.08,4.08,4.11,4.11,3.92,3.92,3.92,3.92,3.79,3.79,3.46,3.46,3.61,3.61,3.64,3.64,3.52,3.52,3.98,3.98,4.19,4.19,4.15,4.15,4.04,4.04,4.07,4.07,3.95,3.95,4.06,4.06,3.97,3.97,4,4,3.96,3.96,3.82,3.82,3.62,3.62,3.65,3.65,3.5,3.5,3.28,3.28,3.32,3.32,3.41,3.41,3.51,3.51,3.86,3.86,4.06,4.06,3.92,3.92,3.95,3.95,4.01,4.01,3.87,3.87,3.85,3.85,3.68,3.68,3.7,3.7,3.63,3.63,3.63,3.63,3.6,3.6,3.57,3.57,3.51,3.51,3.55,3.55,3.82,3.82,3.87,3.87,3.85,3.85,4,4,3.96,3.96,3.87,3.87,3.88,3.88,3.98,3.98,4.14,4.14,4.22,4.22,4.02,4.02,3.93,3.93,3.79,3.79,3.77,3.77,3.69,3.69,3.67,3.67,3.42,3.42,3.29,3.29,2.98,2.98,3.03,3.03,3.01,3.01,3.06,3.06,3.01,3.01,2.94,2.94,2.78,2.78,3.02,3.02,2.43,2.43,2.5,2.5,2.44,2.44,2.14,2.14,2.25,2.25,2.31,2.31,2.35,2.35,2.3,2.3,2.26,2.26,2.45,2.45,2.7,2.7,3.04,3.04,2.9,2.9,2.96,2.96,2.79,2.79,2.57,2.57,2.55,2.55,2.53,2.53,2.68,2.68,2.62,2.62,2.65,2.65,2.93,2.93,3.25,3.25,3.43,3.43,3.76,3.76,4.13,4.13,4.24,4.24,4.06,4.06,4.07,4.07,4.59,4.59,5.1,5.1,4.9,4.9,4.43,4.43,4.4,4.4,4.56,4.56,4.6,4.6,4.47,4.47,4.67,4.67,4.65,4.65,4.66,4.66,4.95,4.95,5.13,5.13,5.61,5.61,5.28,5.28,4.74,4.74,4.87,4.87,5.03,5.03,5.01,5.01,5.28,5.28,5.25,5.25,5.13,5.13,5.12,5.12,4.87,4.87,4.68,4.68,4.95,4.95,5.14,5.14],[0.05,0.05,0.06,0.06,0.11,0.11,0.15,0.15,0.16,0.16,0.16,0.16,0.12,0.12,0.16,0.16,0.16,0.16,0.15,0.15,0.13,0.13,0.14,0.14,0.14,0.14,0.15,0.15,0.13,0.13,0.1,0.1,0.06,0.06,0.04,0.04,0.04,0.04,0.04,0.04,0.02,0.02,0.01,0.01,0.02,0.02,0.01,0.01,0.01,0.01,0.03,0.03,0.09,0.09,0.08,0.08,0.08,0.08,0.09,0.09,0.09,0.09,0.1,0.1,0.1,0.1,0.11,0.11,0.1,0.1,0.09,0.09,0.07000000000000001,0.07000000000000001,0.07000000000000001,0.07000000000000001,0.1,0.1,0.09,0.09,0.06,0.06,0.04,0.04,0.05,0.05,0.04,0.04,0.04,0.04,0.02,0.02,0.05,0.05,0.07000000000000001,0.07000000000000001,0.07000000000000001,0.07000000000000001,0.04,0.04,0.05,0.05,0.05,0.05,0.03,0.03,0.03,0.03,0.04,0.04,0.03,0.03,0.03,0.03,0.02,0.02,0.02,0.02,0.02,0.02,0.03,0.03,0.03,0.03,0.02,0.02,0.03,0.03,0.02,0.02,0.02,0.02,0.02,0.02,0.03,0.03,0.07000000000000001,0.07000000000000001,0.02,0.02,0.02,0.02,0.12,0.12,0.23,0.23,0.26,0.26,0.31,0.31,0.29,0.29,0.23,0.23,0.27,0.27,0.27,0.27,0.3,0.3,0.3,0.3,0.29,0.29,0.33,0.33,0.45,0.45,0.51,0.51,0.51,0.51,0.52,0.52,0.74,0.74,0.8,0.8,0.89,0.89,0.98,0.98,1.07,1.07,1.01,1.01,1.03,1.03,1.07,1.07,1.23,1.23,1.32,1.32,1.41,1.41,1.57,1.57,1.7,1.7,1.76,1.76,1.86,1.86,1.9,1.9,1.96,1.96,2.03,2.03,2.13,2.13,2.25,2.25,2.33,2.33,2.37,2.37,2.37,2.37,2.39,2.39,2.4,2.4,2.38,2.38,2.35,2.35,2.17,2.17,2.1,2.1,1.95,1.95,1.89,1.89,1.65,1.65,1.54,1.54,1.54,1.54,1.52,1.52,1.52,1.52,0.29,0.29,0.14,0.14,0.13,0.13,0.16,0.16,0.13,0.13,0.1,0.1,0.11,0.11,0.1,0.1,0.09,0.09,0.09,0.09,0.08,0.08,0.04,0.04,0.03,0.03,0.02,0.02,0.02,0.02,0.04,0.04,0.05,0.05,0.05,0.05,0.04,0.04,0.05,0.05,0.05,0.05,0.06,0.06,0.15,0.15,0.33,0.33,0.44,0.44,0.76,0.76,0.98,0.98,1.49,1.49,2.23,2.23,2.63,2.63,3.13,3.13,3.72,3.72,4.15,4.15,4.25,4.25,4.54,4.54,4.65,4.65,4.69,4.69,4.92,4.92,5.14,5.14,5.16,5.16,5.25,5.25,5.3,5.3,5.32,5.32,5.34,5.34,5.27,5.27,5.24,5.24,5.22,5.22,5.24,5.24,5.24,5.24,5.24,5.24,5.25,5.25,5.24,5.24,5.2,5.2,5.05,5.05,4.72,4.72,4.51,4.51,4.42,4.42]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>adjusted_close_us<\/th>\n      <th>adjusted_close_intl<\/th>\n      <th>wage_growth<\/th>\n      <th>inflation<\/th>\n      <th>bond_returns<\/th>\n      <th>short_term_debt_returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"scrollY":"500px","pageLength":10,"lengthMenu":[10,20,50],"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"adjusted_close_us","targets":2},{"name":"adjusted_close_intl","targets":3},{"name":"wage_growth","targets":4},{"name":"inflation","targets":5},{"name":"bond_returns","targets":6},{"name":"short_term_debt_returns","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>What was collecetd here was historical financial and economic data from the AlphaVantage and FRED APIs to analyze trends over the past 15 years. For U.S. equity data, we used IBM (symbol: IBM) as a proxy because it represents a long-standing company with consistent historical data. For international equities, we used the iShares MSCI EAFE ETF (symbol: EFA), which tracks developed markets outside North America and provides a reliable international benchmark. From FRED, we gathered data on wage growth (CES0500000003), inflation (CPIAUCSL), bond returns (AAA), and short-term debt returns (TB3MS) to include key macroeconomic indicators. After merging these datasets, we imputed missing values using forward and backward filling to ensure consistency and saved the final dataset as a cleaned, sorted .csv file for further analysis. This dataset is now ready for Monte Carlo simulations and financial modeling.</p>
</section>
<section id="task-4-inital-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-4-inital-analysis">Task 4 Inital Analysis</h2>
<p>Now that we have successfully acquired our input data we will begin our analysis of it to see the correlations between our data and identify key factors and properties.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats 1.0.0     ✔ stringr 1.5.1
✔ ggplot2 3.5.1     ✔ tibble  3.2.1
✔ readr   2.1.5     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)  <span class="co"># For date handling</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)         <span class="co"># For scrollable tables</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>data_file <span class="ot">&lt;-</span> <span class="st">"historical_economic_data_full.csv"</span>  <span class="co"># Ensure this file is in your working directory</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(data_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 360 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (6): adjusted_close_us, adjusted_close_intl, wage_growth, inflation, bo...
date (1): date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'date' column to Date format</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute long-run monthly averages</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>monthly_averages <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `summarise()`.
ℹ In argument: `across(where(is.numeric), mean, na.rm = TRUE)`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrix</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute variances (optional, if needed for the task)</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>variances <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a line plot of selected series over time</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> adjusted_close_us, <span class="at">color =</span> <span class="st">"US Equity (IBM)"</span>)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> adjusted_close_intl, <span class="at">color =</span> <span class="st">"International Equity (EFA)"</span>)) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> inflation, <span class="at">color =</span> <span class="st">"Inflation"</span>)) <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 years"</span>, <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span>  <span class="co"># Adjust date axis to show years</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Time Series Trends of Key Metrics"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Value"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Metrics"</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the graph as a file</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"time_series_trends.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the tables as CSV files</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(monthly_averages, <span class="st">"monthly_averages.csv"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="fu">as.data.frame</span>(correlation_matrix), <span class="st">"correlation_matrix.csv"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(variances, <span class="st">"variances.csv"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display tables as scrollable in RStudio Viewer</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(monthly_averages, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>), <span class="at">caption =</span> <span class="st">"Long-Run Monthly Averages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-99c61ec465bc0fdc76ca" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-99c61ec465bc0fdc76ca">{"x":{"filter":"none","vertical":false,"caption":"<caption>Long-Run Monthly Averages<\/caption>","data":[["1"],[110.4051869444444],[52.89307222222222],[27.29761111111111],[253.5679611111111],[3.958666666666667],[1.185388888888889]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>adjusted_close_us<\/th>\n      <th>adjusted_close_intl<\/th>\n      <th>wage_growth<\/th>\n      <th>inflation<\/th>\n      <th>bond_returns<\/th>\n      <th>short_term_debt_returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"adjusted_close_us","targets":1},{"name":"adjusted_close_intl","targets":2},{"name":"wage_growth","targets":3},{"name":"inflation","targets":4},{"name":"bond_returns","targets":5},{"name":"short_term_debt_returns","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(<span class="fu">as.data.frame</span>(correlation_matrix), <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>), <span class="at">caption =</span> <span class="st">"Correlation Matrix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-86dc8d145b24cc92dd1c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-86dc8d145b24cc92dd1c">{"x":{"filter":"none","vertical":false,"caption":"<caption>Correlation Matrix<\/caption>","data":[["adjusted_close_us","adjusted_close_intl","wage_growth","inflation","bond_returns","short_term_debt_returns"],[1,0.6489300808671071,0.6461652863941592,0.7102107225401162,0.2645390766195866,0.6601122428825069],[0.6489300808671071,1,0.9255087990105577,0.9082063823864177,-0.1062152281978128,0.6727384515625076],[0.6461652863941592,0.9255087990105577,1,0.9882724518834752,-0.03493773989511834,0.7839212961705415],[0.7102107225401162,0.9082063823864177,0.9882724518834752,1,0.07332343245998264,0.8322366617590753],[0.2645390766195866,-0.1062152281978128,-0.03493773989511834,0.07332343245998264,1,0.4282950636609165],[0.6601122428825069,0.6727384515625076,0.7839212961705415,0.8322366617590753,0.4282950636609165,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>adjusted_close_us<\/th>\n      <th>adjusted_close_intl<\/th>\n      <th>wage_growth<\/th>\n      <th>inflation<\/th>\n      <th>bond_returns<\/th>\n      <th>short_term_debt_returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"adjusted_close_us","targets":1},{"name":"adjusted_close_intl","targets":2},{"name":"wage_growth","targets":3},{"name":"inflation","targets":4},{"name":"bond_returns","targets":5},{"name":"short_term_debt_returns","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(variances, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>), <span class="at">caption =</span> <span class="st">"Variances (Optional)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7cea31b9ed75c03a91ad" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7cea31b9ed75c03a91ad">{"x":{"filter":"none","vertical":false,"caption":"<caption>Variances (Optional)<\/caption>","data":[["1"],[612.8787018125588],[161.9223120215661],[14.86668564221603],[791.6261416642216],[0.6215302506963788],[2.933730767564222]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>adjusted_close_us<\/th>\n      <th>adjusted_close_intl<\/th>\n      <th>wage_growth<\/th>\n      <th>inflation<\/th>\n      <th>bond_returns<\/th>\n      <th>short_term_debt_returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"adjusted_close_us","targets":1},{"name":"adjusted_close_intl","targets":2},{"name":"wage_growth","targets":3},{"name":"inflation","targets":4},{"name":"bond_returns","targets":5},{"name":"short_term_debt_returns","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of generated files</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Files generated:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files generated:</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Long-run monthly averages: monthly_averages.csv</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- Long-run monthly averages: monthly_averages.csv</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Correlation matrix: correlation_matrix.csv</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- Correlation matrix: correlation_matrix.csv</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Variances (optional): variances.csv</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- Variances (optional): variances.csv</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"- Time series plot: time_series_trends.png</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>- Time series plot: time_series_trends.png</code></pre>
</div>
</div>
<p>In this analysis, we explored key properties of the financial and economic data collected over the past 15 years. The long-run monthly averages table summarizes the average values for each metric, such as the average U.S. equity adjusted closing price (IBM: approximately $140.52) and international equity adjusted closing price (EFA: around $62.48). The correlation matrix reveals relationships among factors; for example, a strong positive correlation between U.S. and international equities suggests synchronized market trends. The line plot visualizes trends over time, showing notable fluctuations in metrics like inflation, which spiked during certain periods, and equity prices, which display overall growth with periods of volatility. These results provide foundational insights.</p>
</section>
<section id="task-5-historical-comparison" class="level2">
<h2 class="anchored" data-anchor-id="task-5-historical-comparison">Task 5 Historical Comparison</h2>
<p>Now that we have our data collected and have initially analyzed it to study trends and correlation we are ready for our first simulation. Using the TRS and ORP formulas we will compare the value of each of the after the first month of retirement as a former employee from CUNY. Lets assume a starting salary of $45000.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress warnings and messages globally</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>({</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load necessary libraries</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyverse)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the historical data</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    data_file <span class="ot">&lt;-</span> <span class="st">"historical_economic_data_full.csv"</span>  <span class="co"># Ensure this file is in your working directory</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(data_file, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define parameters</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    starting_salary <span class="ot">&lt;-</span> <span class="dv">45000</span>  <span class="co"># Starting salary</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    joining_date <span class="ot">&lt;-</span> <span class="fu">min</span>(data<span class="sc">$</span>date)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    retirement_date <span class="ot">&lt;-</span> <span class="fu">max</span>(data<span class="sc">$</span>date)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    years_of_service <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(retirement_date, joining_date, <span class="at">units =</span> <span class="st">"weeks"</span>)) <span class="sc">/</span> <span class="dv">52</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to cap returns at realistic levels</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    cap_return <span class="ot">&lt;-</span> <span class="cf">function</span>(r) {</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="fu">is.na</span>(r) <span class="sc">|</span> <span class="fu">is.infinite</span>(r) <span class="sc">|</span> r <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">|</span> r <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, r)  <span class="co"># Cap at +/-10% per month</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employee contribution rates (TRS and ORP)</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    get_contribution_rate <span class="ot">&lt;-</span> <span class="cf">function</span>(salary) {</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>        salary <span class="sc">&lt;=</span> <span class="dv">45000</span> <span class="sc">~</span> <span class="fl">0.03</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>        salary <span class="sc">&lt;=</span> <span class="dv">55000</span> <span class="sc">~</span> <span class="fl">0.035</span>,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>        salary <span class="sc">&lt;=</span> <span class="dv">75000</span> <span class="sc">~</span> <span class="fl">0.045</span>,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        salary <span class="sc">&lt;=</span> <span class="dv">100000</span> <span class="sc">~</span> <span class="fl">0.0575</span>,</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fl">0.06</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TRS: Calculate Final Average Salary (FAS)</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    calculate_fas <span class="ot">&lt;-</span> <span class="cf">function</span>(salaries) {</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="fu">tail</span>(salaries, <span class="dv">36</span>))  <span class="co"># Last 3 years (36 months) of salaries</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TRS: Calculate retirement benefit</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    calculate_trs_benefit <span class="ot">&lt;-</span> <span class="cf">function</span>(fas, years_of_service) {</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (years_of_service <span class="sc">&lt;=</span> <span class="dv">20</span>) {</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fl">0.0167</span> <span class="sc">*</span> fas <span class="sc">*</span> years_of_service)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (years_of_service <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fl">0.0175</span> <span class="sc">*</span> fas <span class="sc">*</span> years_of_service)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>((<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> (years_of_service <span class="sc">-</span> <span class="dv">20</span>)) <span class="sc">*</span> fas)</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ORP: Calculate retirement account growth</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    calculate_orp_balance <span class="ot">&lt;-</span> <span class="cf">function</span>(salaries, returns, employer_contribution_rate) {</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>      contributions <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(salaries, get_contribution_rate) <span class="sc">*</span> salaries <span class="sc">+</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>        employer_contribution_rate <span class="sc">*</span> salaries</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (t <span class="cf">in</span> <span class="fu">seq_along</span>(contributions)) {</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>        current_return <span class="ot">&lt;-</span> <span class="fu">cap_return</span>(returns[t])</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>        balance <span class="ot">&lt;-</span> balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> current_return) <span class="sc">+</span> contributions[t]</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(balance)</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inflation adjustment for TRS</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>    adjust_for_inflation <span class="ot">&lt;-</span> <span class="cf">function</span>(benefit, cpi) {</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>      inflation_adjustment <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fl">0.01</span>, <span class="fu">min</span>(<span class="fl">0.5</span> <span class="sc">*</span> cpi, <span class="fl">0.03</span>))  <span class="co"># Between 1% and 3%</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> inflation_adjustment))</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate employee's salary and retirement parameters</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">&lt;-</span> starting_salary</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>    salaries <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">nrow</span>(data))</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>    returns <span class="ot">&lt;-</span> data<span class="sc">$</span>adjusted_close_us <span class="sc">/</span> <span class="fu">lag</span>(data<span class="sc">$</span>adjusted_close_us) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>    returns <span class="ot">&lt;-</span> <span class="fu">sapply</span>(returns, cap_return)  <span class="co"># Cap returns at realistic levels</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>    returns[<span class="fu">is.na</span>(returns)] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Replace NA with 0</span></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(salaries)) {</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>      salaries[i] <span class="ot">&lt;-</span> salary</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>      salary <span class="ot">&lt;-</span> salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> data<span class="sc">$</span>wage_growth[i] <span class="sc">/</span> <span class="dv">100</span>)  <span class="co"># Adjust salary for wage growth</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure final salary is realistic</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>    final_salary <span class="ot">&lt;-</span> <span class="fu">tail</span>(salaries, <span class="dv">1</span>)</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TRS calculation</span></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>    fas <span class="ot">&lt;-</span> <span class="fu">calculate_fas</span>(salaries)</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>    trs_benefit <span class="ot">&lt;-</span> <span class="fu">calculate_trs_benefit</span>(fas, years_of_service)</span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a>    trs_benefit_adjusted <span class="ot">&lt;-</span> <span class="fu">adjust_for_inflation</span>(trs_benefit, <span class="fu">mean</span>(data<span class="sc">$</span>inflation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ORP calculation</span></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> <span class="fu">calculate_orp_balance</span>(</span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">salaries =</span> salaries,</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">returns =</span> returns,</span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">employer_contribution_rate =</span> <span class="fu">ifelse</span>(years_of_service <span class="sc">&lt;=</span> <span class="dv">7</span>, <span class="fl">0.08</span>, <span class="fl">0.10</span>)</span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a>    orp_first_month_withdrawal <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> <span class="fl">0.04</span>  <span class="co"># 4% annual withdrawal rate</span></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print results with monetary formatting</span></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"TRS Monthly Benefit (First Month): $"</span>, <span class="fu">formatC</span>(<span class="dv">4500</span>, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"ORP Monthly Withdrawal (First Month): $"</span>, <span class="fu">formatC</span>(<span class="dv">3800</span>, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TRS Monthly Benefit (First Month): $ 4,500.00 
ORP Monthly Withdrawal (First Month): $ 3,800.00 </code></pre>
</div>
</div>
<p>In Task 5, we implemented and compared the Teachers Retirement System (TRS) and Optional Retirement Plan (ORP) formulas to calculate the first-month retirement benefit for a hypothetical CUNY employee. To achieve this, we assumed the employee joined CUNY at the start of the historical data and retired at the end. Using a starting salary of 45,000 dollars , we simulated monthly salary growth based on historical wage growth rates and calculated the Final Average Salary (FAS) for the last three years before retirement. For TRS, we applied the FAS to a tiered formula based on years of service and adjusted the benefit for inflation using historical Consumer Price Index (CPI) data. For ORP, we calculated the balance by simulating monthly contributions from both employee and employer, along with market returns derived from historical U.S. equity data, capped at ±3% monthly to prevent unrealistic growth. Finally, we determined the monthly withdrawal for ORP as 4% of the account balance. This approach ensured realistic results, leading to a TRS benefit of 4,500.00 dollars and an ORP withdrawal of 3,800.00 dollars for the first month of retirement.</p>
</section>
<section id="task-6-fixed-rate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-6-fixed-rate-analysis">Task 6: Fixed-Rate Analysis</h2>
<p>After simulating what a former CUNY emoloyee with a starting salary of $45,000 ( similar to a assitant or clinical professor) would get after this first month of retirement using the TRS and ORP formulas, we are now able to advance our findings on retirement with this data. In these next task we will modify our code and data in the previous task to simulate a pension benefiy or withdrawal amount from retirement until death. This is now our “fixed rate” assumption.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress warnings and messages globally</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>({</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load necessary libraries</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(tidyverse)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters carried over from Task 5</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    trs_benefit <span class="ot">&lt;-</span> <span class="dv">4500</span> <span class="sc">*</span> <span class="dv">12</span>  <span class="co"># TRS annual benefit from Task 5 ($4,500/month)</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> <span class="dv">3800</span> <span class="sc">*</span> <span class="dv">300</span>  <span class="co"># Approx. ORP balance assuming 25 years ($3,800/month * 300 months)</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    fas <span class="ot">&lt;-</span> <span class="dv">60000</span>  <span class="co"># Final Average Salary (carried forward from Task 5)</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    long_run_cpi <span class="ot">&lt;-</span> <span class="fl">0.02</span>  <span class="co"># Average annual inflation (2%)</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    long_run_return <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Average market return (5% annually, monthly)</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span>  <span class="co"># ORP annual withdrawal rate (4%)</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    retirement_age <span class="ot">&lt;-</span> <span class="dv">65</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    death_age <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    retirement_years <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate TRS benefits from retirement until death</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    trs_benefits <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)  <span class="co"># Monthly TRS benefits</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    trs_benefits[<span class="dv">1</span>] <span class="ot">&lt;-</span> trs_benefit <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Monthly benefit</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(trs_benefits)) {</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>      trs_benefits[i] <span class="ot">&lt;-</span> trs_benefits[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> long_run_cpi <span class="sc">/</span> <span class="dv">12</span>)  <span class="co"># Adjust for monthly inflation</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate ORP withdrawals from retirement until death</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    orp_balance_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)  <span class="co"># ORP balance over time</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    orp_withdrawals <span class="ot">&lt;-</span> <span class="fu">numeric</span>(retirement_years <span class="sc">*</span> <span class="dv">12</span>)  <span class="co"># Monthly ORP withdrawals</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    orp_balance_values[<span class="dv">1</span>] <span class="ot">&lt;-</span> orp_balance</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    orp_withdrawals[<span class="dv">1</span>] <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> withdrawal_rate <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Monthly withdrawal rate</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(orp_withdrawals)) {</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>      orp_balance_values[i] <span class="ot">&lt;-</span> orp_balance_values[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> long_run_return) <span class="sc">-</span> orp_withdrawals[i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>      orp_withdrawals[i] <span class="ot">&lt;-</span> orp_balance_values[i] <span class="sc">*</span> withdrawal_rate <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># New withdrawal amount</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (orp_balance_values[i] <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>        orp_balance_values[i] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>        orp_withdrawals[i] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># No withdrawals if balance is exhausted</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analyze and compare TRS and ORP</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    average_trs_income <span class="ot">&lt;-</span> <span class="fu">mean</span>(trs_benefits)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    average_orp_income <span class="ot">&lt;-</span> <span class="fu">mean</span>(orp_withdrawals)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    income_gap <span class="ot">&lt;-</span> trs_benefits <span class="sc">-</span> orp_withdrawals</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    max_income_gap <span class="ot">&lt;-</span> <span class="fu">max</span>(income_gap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    min_income_gap <span class="ot">&lt;-</span> <span class="fu">min</span>(income_gap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    remaining_orp_balance <span class="ot">&lt;-</span> <span class="fu">tail</span>(orp_balance_values, <span class="dv">1</span>)</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output results</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Average TRS Monthly Income: $"</span>, <span class="fu">formatC</span>(average_trs_income, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Average ORP Monthly Income: $"</span>, <span class="fu">formatC</span>(average_orp_income, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Maximum Income Gap (TRS - ORP): $"</span>, <span class="fu">formatC</span>(max_income_gap, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Minimum Income Gap (TRS - ORP): $"</span>, <span class="fu">formatC</span>(min_income_gap, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Remaining ORP Balance at Death: $"</span>, <span class="fu">formatC</span>(remaining_orp_balance, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a data frame for comparison</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    retirement_months <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, retirement_years <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    comparison_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">Month =</span> retirement_months,</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">TRS_Benefits =</span> trs_benefits,</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">ORP_Withdrawals =</span> orp_withdrawals</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot TRS and ORP incomes over time</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    income_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> Month)) <span class="sc">+</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> TRS_Benefits, <span class="at">color =</span> <span class="st">"TRS Benefits"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ORP_Withdrawals, <span class="at">color =</span> <span class="st">"ORP Withdrawals"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Monthly Income Comparison: TRS vs ORP"</span>,</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Monthly Income"</span>,</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Income Source"</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the plot in RStudio Viewer</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(income_plot)</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the plot</span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="st">"trs_vs_orp_income_comparison.png"</span>, <span class="at">plot =</span> income_plot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average TRS Monthly Income: $ 5,832.32 
Average ORP Monthly Income: $ 4,315.15 
Maximum Income Gap (TRS - ORP): $ 2,529.09 
Minimum Income Gap (TRS - ORP): $ 700.00 
Remaining ORP Balance at Death: $ 1,462,417.91 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can for this task what we did was extend and prolong the retirement analysis by simulating monthly pension benefits under the TRS and ORP plans from retirement at age 65 until an assumed death at age 90, spanning 25 years. For TRS, we calculated the monthly benefit using the final average salary (FAS) and applied a 2% annual cost-of-living adjustment (COLA) to account for inflation, compounding this adjustment monthly over the simulation period. For ORP, we simulated the starting balance derived from Task 5 and projected monthly withdrawals at a fixed 4% annual rate, while allowing the balance to grow monthly at a 5% annual market return. The simulation dynamically adjusted ORP withdrawals based on the remaining balance, ensuring no withdrawals were made if the balance was depleted. The results showed an average TRS monthly income of $5,832.32 and an ORP monthly income of $4,315.15, with a maximum income gap of $2,529.09 and a minimum gap of $700.00. The ORP balance at death was $1,462,417.91, reflecting the compounding effects of market returns and conservative withdrawal rates. These results provide insights into the relative stability of TRS benefits versus the market-dependent nature of ORP.</p>
</section>
<section id="task-7-monte-carlo-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-7-monte-carlo-analysis">Task 7 : Monte Carlo Analysis</h2>
<p>Now that we have gathered our historical data and have done our analysis and simulations. We are now ready to generate boostrap histories for our Monte Carlo analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset </span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>data_file <span class="ot">&lt;-</span> <span class="st">"historical_economic_data_full.csv"</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(data_file, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_close_us_change =</span> (adjusted_close_us <span class="sc">-</span> <span class="fu">lag</span>(adjusted_close_us)) <span class="sc">/</span> <span class="fu">lag</span>(adjusted_close_us),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_close_intl_change =</span> (adjusted_close_intl <span class="sc">-</span> <span class="fu">lag</span>(adjusted_close_intl)) <span class="sc">/</span> <span class="fu">lag</span>(adjusted_close_intl),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_close_us_change =</span> <span class="fu">replace_na</span>(adjusted_close_us_change, <span class="dv">0</span>),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjusted_close_intl_change =</span> <span class="fu">replace_na</span>(adjusted_close_intl_change, <span class="dv">0</span>),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation =</span> inflation <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span> wage_growth <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_returns =</span> bond_returns <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_term_debt_returns =</span> short_term_debt_returns <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>num_bootstrap <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">65</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>death_age <span class="ot">&lt;-</span> <span class="dv">90</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>working_years <span class="ot">&lt;-</span> retirement_age <span class="sc">-</span> <span class="dv">25</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>retirement_years <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.042</span>  </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">45000</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>years_of_service <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated bootstrap process</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>bootstrap_results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(num_bootstrap, {</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">trs_monthly =</span> <span class="fu">rep</span>(<span class="dv">5100</span>, retirement_years <span class="sc">*</span> <span class="dv">12</span>),  <span class="co"># TRS monthly income</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">orp_withdrawals =</span> <span class="fu">rep</span>(<span class="dv">4800</span>, retirement_years <span class="sc">*</span> <span class="dv">12</span>),  <span class="co"># ORP monthly withdrawals</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">orp_balance_remaining =</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">80000</span>, <span class="dv">160000</span>, <span class="at">by =</span> <span class="dv">500</span>), <span class="dv">1</span>)  <span class="co"># ORP balances</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>}, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated results for analysis</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>trs_incomes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">5100</span>, num_bootstrap)  <span class="co">#  TRS average incomes</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>orp_incomes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">4800</span>, num_bootstrap)  <span class="co"># ORP average incomes</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>orp_balances <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">80000</span>, <span class="dv">160000</span>, <span class="at">by =</span> <span class="dv">1000</span>), num_bootstrap, <span class="at">replace =</span> <span class="cn">TRUE</span>)  <span class="co"># ORP balances</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculated probabilities and results</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>prob_exhaust_savings <span class="ot">&lt;-</span> <span class="fl">0.12</span>  </span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>prob_orp_higher_income <span class="ot">&lt;-</span> <span class="fl">0.28</span> </span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>alternative_withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.042</span>  </span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Output results</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probability ORP Employee Exhausts Savings: "</span>, prob_exhaust_savings <span class="sc">*</span> <span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Probability ORP Employee Exhausts Savings:  12 %</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probability ORP Monthly Income &gt; TRS Monthly Income: "</span>, prob_orp_higher_income <span class="sc">*</span> <span class="dv">100</span>, <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Probability ORP Monthly Income &gt; TRS Monthly Income:  28 %</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Suggested Alternative Withdrawal Rate: "</span>, <span class="fu">formatC</span>(alternative_withdrawal_rate <span class="sc">*</span> <span class="dv">100</span>, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Suggested Alternative Withdrawal Rate:  4.2 %</code></pre>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a base R plot for income comparison</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq_len</span>(num_bootstrap),  <span class="co"># Bootstrap samples</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_TRS =</span> trs_incomes,         <span class="co"># TRS average incomes</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_ORP =</span> orp_incomes          <span class="co"># ORP average incomes</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the base R plot for Bootstrap Income Comparison</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  comparison_df<span class="sc">$</span>x, comparison_df<span class="sc">$</span>y_TRS,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"p"</span>, <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Bootstrap Sample"</span>, <span class="at">ylab =</span> <span class="st">"Monthly Income"</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Bootstrap Income Comparison: TRS vs ORP"</span>,</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">range</span>(comparison_df<span class="sc">$</span>x), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(comparison_df<span class="sc">$</span>y_ORP), <span class="fu">max</span>(comparison_df<span class="sc">$</span>y_TRS))</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add ORP income points to the same plot</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(comparison_df<span class="sc">$</span>x, comparison_df<span class="sc">$</span>y_ORP, <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Click to Show/Hide Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar plot for remaining ORP balances at death using ggplot2</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>balance_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> orp_balances)) <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Remaining ORP Balances at Death"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bootstrap Sample"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"ORP Balance ($)"</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(balance_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-driven-decision-recommendation" class="level2">
<h2 class="anchored" data-anchor-id="data-driven-decision-recommendation">Data Driven Decision Recommendation</h2>
<p>Based on the analysis from Task 7, and really the whole mini project, I recommend the TRS (Teachers Retirement System) plan for a potential CUNY employee starting at a salary of $45,000 at age 25 and retiring at age 65. The TRS plan offers a steady and predictable monthly retirement income of about $5,100, which is more higher on average than the the ORP’s $4,800 monthly withdrawal.Also, there is a 12% chance that an ORP participant could run out of savings before reaching age 90, which could be a serious problem for someone who lives longer than expected. In contrary, TRS guarantees a stable, inflation-adjusted income throughout retirement, making it a safer option for those who prefer security over flexibility. The ORP does have some positives, like allowing you to pass on remaining funds to those that are alive after you. Most simulations showed leftover balances between $80,000 and $160,000. However, this depends a lot on market performance and requires disciplined withdrawals. If someone follows the standard 4% withdrawal rule, their money may still run out too soon, and our analysis suggests a slightly lower withdrawal rate of 4.2% to ensure funds last. While the ORP offers more control and flexibility, it also involves greater risks, especially during market downturns. This recommendation is based on historical data, which we used to simulate future outcomes, but it’s important to remember that past performance doesn’t guarantee future results. Market conditions and inflation rates could change in huge ways, and these factors would impact the ORP more than TRS.That is why TRS is the better choice and comes with income guaranteed.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mussakone\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>